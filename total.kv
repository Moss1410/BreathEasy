######### Kivy Custom Class Definitions: #########

# Define  background color Template
<Label@Widget>
    color: 0,0,0,1    # Sets the default text color to black

<ChangeLabel@Widget>
    color: 0,0,0,1
    font_size: str(self.height*1.2)+'sp'
    halign: 'left'
    valign: 'center'
    bold: True

# Define  background color Template
<BackgroundColor@Widget>
    background_color: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: root.background_color
        RoundedRectangle:
            radius: [5,]
            size: self.size
            pos: self.pos

# BackgroundLabel Class
<BackgroundLabel@Label+BackgroundColor>
    background_color: 0, 0, 0, 1    # Default background color

# BackgroundLabel Class
<BackgroundLogic@Logic+BackgroundColor>
    background_color: 0, 0, 0, 1    # Default background color

# BackgroundLabel Class
<LightBlueBackgroundLabel@Label+BackgroundColor>
    background_color: 0.82, 0.9, 0.94, 1    # Default background color

### Title Area ###
# Title logic box
<TopPanelLogic@Logic>
    size_hint: 1, 0.05
    spacing: 20

# Title logic box
<SettingsTopPanelLogic@Logic>
    size_hint: 1, 0.05
    spacing: 20

# BackgroundLabel Class
<TitleLabel@Label+BackgroundColor>
    background_color: 0,0,0,0    # Invisible Background
    font_size: str(int(self.height)/1.2)+'sp'
    bold: True
    italic: True
    color: 0,166/255,255/255,1

# BackgroundLogic Class
<CustomDropDown@Logic>
    # background_color: 0.82, 0.9, 0.94, 1    # Default background color
    spacing: 20

# BackgroundLogic Class
<LightBlueBackgroundLogic@Logic+BackgroundColor>
    background_color: 0.82, 0.9, 0.94, 1    # Default background color

# BackgroundLogic Class
<LightBlueBackgroundButton@Button>
    background_color: 0, 0, 0, 0 # this sets the button to ckear so we can see the background behind
    canvas.before:
        Color:
            rgba: 0.82, 0.9, 0.94, 1 # this sets the color of the background behind
        RoundedRectangle:
            radius: [5,]
            size: self.size
            pos: self.pos

# BackgroundLogic Class
<DropDownItemButton@BigVButton>
    height: 200
    # padding 20, 20, 20, 20

<DropDownHeaderButton@BigVButton>
    # padding: 20, 20, 20, 20


# # BackgroundLogic Class
# <LightBlueBackgroundButton@Button>
#     background_color: 0, 0, 0, 0 # this sets the button to ckear so we can see the background behind
#     canvas.before:
#         Color:
#             # rgba: 0.82, 0.9, 0.94, 1 # this sets the color of the background behind
#             rgba: self.background_color
#         RoundedRectangle:
#             radius: [20,]
#             size: self.size
#             pos: self.pos
#     on_press: self.background_color = 0, 0, 1, 1
#     on_release: self.background_color = 0, 0, 0, 0

<BigVButton@VButton+LightBlueBackgroundButton>
    font_size: str(int(self.height)/5)+'sp'
    #color: 0/255,51/255,255/255,1  # Bright blue text color
    bold: True
    size_hint: 1,1

<BigButton@VButton+LightBlueBackgroundButton>
    font_size: str(int(self.height)/5)+'sp'
    #color: 0/255,51/255,255/255,1  # Bright blue text color
    bold: True
    size_hint: 1,1


<SmallVButton@VButton+LightBlueBackgroundButton>
    font_size: str(int(self.height)/1.5)+'sp'
    #color: 0/255,51/255,255/255,1  # Bright blue text color
    bold: True
    size_hint: 1,1

### Output Buttons Area ###
<OutputLogic@Logic>
    spacing: 15
    size_hint: 0.1, 1
    orientation: "vertical"

### Whole Page Enclosing Area ###
<BaseLogic@Logic>
    spacing: 20
    orientation: 'vertical'
    padding: 25, 25, 25, 25

### Mid panel area (graph and output labels) ###
<MidPanelLogic@Logic>
    spacing: 20
    size_hint: 1, 0.8

<SettingsMidPanelLogic@Logic>
    spacing: 10
    size_hint: 1, 0.2
    orientation: 'horizontal'

<SettingsColumnLogic@Logic>
    spacing: 20
    # size_hint: 1, 0.2
    orientation: 'vertical'

<SettingsItemLogic@Logic>
    size_hint: 1, 1
    orientation: 'vertical'

<SettingsItemLabel@Label>
    size_hint: 1, 1
    text_size: self.width-80, None
    font_size: str(int(self.height)/3)+'sp'
    color: 0,166/255,255/255,1  # Bright blue text color
    halign: 'center'

<SettingsBottomPanelLogic@Logic>
    spacing: 20
    size_hint: 1, 0.75
    orientation: 'horizontal'

<OutputLabel@Label>
    text_size: self.width-40, None
    font_size: str(self.height/5)+'sp'
    bold: True
    halign: 'center'
    valign: 'top'

### Bottom Panel Area ###
<BottomPanelLogic@Logic>
    spacing: 20
    size_hint: 1, 0.15

<InputLogic@LightBlueBackgroundLogic>
    orientation: 'vertical'
    size_hint: 0.125, 1

<InputLabel@LightBlueBackgroundLabel>
    text_size: root.width-40, None
    halign: 'center'
    valign: 'center'
    font_size: str(self.height/4.5)+'sp'
    size_hint: 1, 1
    bold: True

<InputValueLabel@LightBlueBackgroundLabel>
    size_hint: 1, 0.4
    bold: True
    halign: 'center'
    valign: 'top'  #I DONT THINK THESE DO ANYTHING, CANT WORK OUT PLACEMENT
    font_size: str(self.height*1.8)+'sp'

<InputProgressBar@ProgressBar>
    size_hint: 1, 0.4

### Graphs Area ###
<GraphGroupLogic@Logic>
    spacing: 20
    orientation: 'vertical'
    size_hint: 0.9, 1

<GraphLogic@LightBlueBackgroundLogic>
    #background_color: 0, 0, 0, 1 #for black background graphs
    size_hint: [1, .9]

<Grapher@Widget>
    xlabel: ""
    x_ticks_major: 500
    y_ticks_major: 200
    y_grid_label: True
    x_grid_label: True
    padding: 2
    x_grid: True 
    y_grid: True
    label_options: {'color': (0,0,0,1)}
    border_color: (0,0,0,1)

### Alarms Area ###
<AlarmGroupLogic@Logic>
    spacing: 15

<AlarmLabel@LightBlueBackgroundLabel>
    background_color: 0,1,0,0.5
    text_size: root.width-60, None
    halign: 'center'
    valign: 'center'
    font_size: str(self.height/3)+'sp'
    bold: True
    italic: True

<MenuScreen@Screen>

<SettingsScreen@Screen>


###### Screenmanager #######################################################################
ScreenManager:
    id: sm
    ###### Main Screen UI Layout #######################################################################
    MenuScreen:
        name: 'menu'
        id: menuScreen

        BaseLogic:
            id: root_box
            
            # TITLE PANEL
            TopPanelLogic:
                TitleLabel:
                    text: 'BreathEasy Ventilator Monitor'
                # Button:
                #     text: 'Switch screens'
                #     on_press: root.manager.current = 'menu'
                LightBlueBackgroundButton:
                    size_hint: 0.2, 1
                    text: 'Edit Settings'
                    font_size: str(int(self.height)/2)+'sp'
                    bold: True
                    on_press: 
                        menuScreen.manager.current = 'settings'
                        menuScreen.manager.transition.direction = 'left'

            # GRAPHS & OUTPUTS PANEL
            MidPanelLogic:
                # Triple Graph Group
                GraphGroupLogic:
                    id: graph_group
                    ######################################
                    Logic:
                        # Setting the background color
                        orientation: "vertical"
                        GraphLogic:
                            PeakPressure:
                                id: "graph1"
                                ylabel: "Peak Pressure"
                    ######################################

                    ######################################
                    Logic:
                        LightBlueBackgroundLogic:
                            orientation: "vertical"
                            Logic:
                                size_hint: [1, .9]
                                RespiratoryRate:
                                    id: "graph1"
                                    ylabel: "Respiratory Rate"
                    ######################################

                    ######################################
                    Logic:
                        # Setting the background color
                        orientation: "vertical"
                        GraphLogic:
                            TidalVolume:
                                id: "graph1"
                                ylabel: "Tidal Volume"
                    ######################################

                # Output Parameters
                OutputLogic:
                    id: outputs_panel

                    # Parameter 1
                    LightBlueBackgroundLogic:
                        orientation: 'vertical'
                        OutputLabel:
                            text: 'O2 [%]:'
                        ChangeLabel:
                            color: 0,0,1,1
                            id: Fi02
                            font_size: str(self.height)+'sp'
                            halign: 'left'
                            valign: 'center'
                            bold: True
                            name: "Fi02"
                            text: "root.Fi0"

                            
                    # Parameter 2
                    LightBlueBackgroundLogic:
                        orientation: 'vertical'

                        OutputLabel:
                            text: 'Voltage [V]:'
                            
                        ChangeLabel: 
                            color: 0.45,0,1,1
                            id: voltage
                            name: "voltage"
                            text: "root.voltage"
                            
                    # Parameter 3
                    LightBlueBackgroundLogic:
                        orientation: 'vertical'
                        OutputLabel:
                            text: 'PEEP [cmH2O]:'
                            
                        ChangeLabel:
                            color: 1,0,0,1
                            id: PEEP
                            name: "PEEP"
                            text: "root.PEEP"
                            
                    # Parameter 4
                    LightBlueBackgroundLogic:
                        orientation: 'vertical'
                        OutputLabel: 
                            text: 'RR [Br/min]:'

                            
                        ChangeLabel:
                            color: 0, 0.5, 0, 1
                            id: respiratory_rate
                            name: "respiratory_rate"
                            text: "root.respiratory_rate"
                            
            # Input Parameters
            BottomPanelLogic:
                id: inputs_panel

                # Parameter 1
                InputLogic:
                    InputLabel:
                        text: 'Min RR [b/min]'
                        
                    InputValueLabel:
                        name: "min_RR"
                        text: str(int(input_1.value))

                    InputProgressBar:
                        id: input_1
                        name: "min_RR"
                        min: 4
                        max: 14
                        value: 8
                        size_hint: 1, 0.4


                # Parameter 2
                InputLogic:
                    InputLabel:
                        text: 'Pi [cmH2O]'  
                    InputValueLabel:
                        name: "max_inspiratory_pressure"
                        text: str(int(input_2.value))
                        
                    InputProgressBar:
                        id: input_2
                        name: "max_inspiratory_pressure"
                        min: 10
                        max: 20
                        value: 15

                # Parameter 3
                InputLogic:
                    InputLabel:
                        text: 'Ti [s]'  #Inspiratory Time
                        
                    InputValueLabel:
                        name: "inspiratory_time"
                        text: str(int(input_3.value))
                        
                    InputProgressBar:
                        id: input_3
                        name: "inspiratory_time"
                        min: 0.5
                        max: 2
                        value: 1

                # Parameter 4
                InputLogic:
                    InputLabel:
                        text: 'PEEP [cmH2O]'
                        
                    InputValueLabel:
                        name: "PEEP"
                        text: str(int(input_4.value))
                        
                    InputProgressBar:
                        id: input_4
                        name: "PEEP"
                        min: 5
                        max: 12
                        value: 5

                # Parameter 5
                InputLogic:
                    InputLabel:
                        text: 'FiO2 [%]'
                        
                    InputValueLabel:
                        name: "FiO2"
                        text: str(int(input_5.value))
                        
                    InputProgressBar:
                        id: input_5
                        name: "FiO2"
                        min: 0.3
                        max: 1
                        value: 1

                # Parameter 6
                InputLogic:
                    InputLabel:
                        text: 'TV [mL]'    #Tidal Volume
                        
                    InputValueLabel:
                        name: "tidal_volume"
                        text: str(int(input_6.value))
                        
                    InputProgressBar:
                        id: input_6
                        name: "tidal_volume"
                        min: 200
                        max: 800
                        value: 600

                ################################
                # Alarms Panel
                AlarmGroupLogic:
                    spacing: 15
                    orientation: 'vertical'
                    size_hint: 0.25, 1
                    AlarmGroupLogic:
                    #     AlarmLabel:
                    #         text: 'Signal Lost'
                        AlarmLabel:
                            background_color: 1,0,0,1
                            # background_color: 0,1,0,1
                            text: 'Low RR'
                                
                    # AlarmGroupLogic:
                    #     AlarmLabel:
                    #         background_color: 252/255,127/255,3/255,1
                    #         text: 'PEEP Low'
                    #     AlarmLabel:
                    #         text: 'Low FiO2'
                ################################
    ###### SettingsScreen UI Layout #######################################################################
    SettingsScreen:
        id: settingsScreen
        name: 'settings'

        BaseLogic:
            # BackgroundLogic:
            #     size_hint_y: 0.33
            #     background_color: 1, 0, 0, 1

            #     id: settings_root_box

            # BackgroundLogic:
            #     size_hint_y: 0.33
            #     background_color: 0, 0, 1, 1

            TopPanelLogic:
                TitleLabel:
                    text: 'Set Ventilation Properties'
                    font_size: str(int(self.height)/1.5)+'sp'
                    #color: 0,166/255,255/255,1  # Bright blue text color
                    bold: True

                LightBlueBackgroundButton:
                    size_hint: 0.2, 1
                    text: 'Save Settings'
                    font_size: str(int(self.height)/2)+'sp'
                    #color: 0,166/255,255/255,1  # Bright blue text color
                    bold: True

                    on_press: 
                        settingsScreen.manager.current = 'menu'
                        settingsScreen.manager.transition.direction = 'right'

            # GRAPHS & OUTPUTS PANEL
            SettingsMidPanelLogic:
<<<<<<< HEAD
<<<<<<< HEAD
                CustomDropDown:
                    spacing: 20
                    DropDownHeaderButton:
                        id: modeSelect
                        text: "Ventilation Mode"   
                        on_parent: dropdown1.dismiss()
                        on_release: dropdown1.open(self)
                    DropDown:
                        spacing: 20
                        id: dropdown1
                        on_select: modeSelect.text = '{}'.format(args[1])
                        Logic: 
                        DropDownItemButton:
                            text: 'First Item'
                            size_hint_y: None
                            on_release: dropdown1.select('First Item')
                        DropDownItemButton:
                            text: 'Second Item'
                            size_hint_y: None
                            on_release: dropdown1.select('Second Item')
                        DropDownItemButton:
                            text: 'Third Item'
                            size_hint_y: None
                            on_release: dropdown1.select('Third Item')
                CustomDropDown:
                    spacing: 20
                    DropDownHeaderButton:
                        id: storePresetSelect
                        text: "Store Preselect" 
                        on_parent: dropdown2.dismiss()
                        on_release: dropdown2.open(self)
                    DropDown:
                        spacing: 20
                        id: dropdown2
                        on_select: storePresetSelect.text = '{}'.format(args[1])
                        Logic: 
                        DropDownItemButton:
                            text: 'First Item'
                            size_hint_y: None
                            on_release: dropdown2.select('First Item')
                        DropDownItemButton:
                            text: 'Second Item'
                            size_hint_y: None
                            on_release: dropdown2.select('Second Item')
                        DropDownItemButton:
                            text: 'Third Item'
                            size_hint_y: None
                            on_release: dropdown2.select('Third Item')
=======
                BigVButton:
                    id: modeSelect
                    text: "Ventilation Mode"   
                    #on_release: ventilatorModeDropDown.open
                BigButton:
                    id: storePresetSelect
                    on_press: self.callback()
                    text: "Store Presets"
>>>>>>> 7c51b217a3b6f955151a7a26ab5748763e703189
                CustomDropDown:
                    spacing: 20
                    DropDownHeaderButton:
                        id: presetSelect
                        text: "Presets"
                        on_parent: dropdown3.dismiss()
                        on_release: dropdown3.open(self)
                    DropDown:
                        spacing: 20
                        id: dropdown3
                        on_select: presetSelect.text = '{}'.format(args[1])
                        Logic: 
                        DropDownItemButton:
                            text: 'First Item'
                            size_hint_y: None
                            on_release: dropdown3.select('First Item')
                        DropDownItemButton:
                            text: 'Second Item'
                            size_hint_y: None
                            on_release: dropdown3.select('Second Item')
                        DropDownItemButton:
                            text: 'Third Item'
                            size_hint_y: None
                            on_release: dropdown3.select('Third Item')

<<<<<<< HEAD
<<<<<<< HEAD
=======
                BigVButton:
                    id: modeSelect
                    text: "Ventilation Mode"   
                    #on_release: ventilatorModeDropDown.open
                BigButton:
                    id: storePresetSelect
                    on_press: self.callback()
                    text: "Store Presets"
=======


>>>>>>> 7c51b217a3b6f955151a7a26ab5748763e703189
                BigVButton:
                    id: presetSelect
                    text: "Presets"
                   # on_release: presetModeDropDown.open
<<<<<<< HEAD
>>>>>>> origin/Olivia
=======
>>>>>>> 7c51b217a3b6f955151a7a26ab5748763e703189

=======
>>>>>>> Olivia
            SettingsBottomPanelLogic:
                # # Title Row
                # SettingsColumnLogic:
                #     size_hint: 1, 0.3
                #     LightBlueBackgroundLabel:
                #         id: VentilationSettingstitle
                #         text: 'All Configurable Properties'
                #         font_size: '20dp'
                #         bold: "true"
                # Column 1
                SettingsColumnLogic:
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: PEEP
                            text: "PEEP [cmH2O]"
                        SmallVButton:
                            id: PEEP
                            name: "PEEP"
                            text: "5.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: FiO2
                            text:"FiO2 [%]"
                        SmallVButton:
                            name: 'FiO2'
                            id: FiO2
                            text: "1.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: min_RR
                            text: "Min RR [Breaths/min]"
                        SmallVButton:
                            id: min_RR
                            name: "min_RR"
                            text: "10.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_RR
                            text: "Max RR [Breaths/min]"
                        SmallVButton:
                            name: 'max_RR'
                            id: max_RR
                            text: "25.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: IE_ratio
                            text: "I:E Ratio [Ratio]"
                        SmallVButton:
                            name: 'IE_ratio'
                            id: IE_ratio
                            text: "0.5"
                            on_press: self.callback()
                # Column 2
                SettingsColumnLogic:
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: inspiratory_rise_time
                            text: "Inspiratory Rise Time [Seconds]"
                        SmallVButton:
                            name: 'inspiratory_rise_time'
                            id: inspiratory_rise_time
                            text: "0.2"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: inspiratory_time
                            text: 'Inspiratory Time [Seconds]'
                        SmallVButton:
                            name: 'inspiratory_time'
                            id: inspiratory_time
                            text: "1.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: min_inspiratory_time
                            text:'Min Inspiratory Time [Seconds]'
                        SmallVButton:
                            name: 'min_inspiratory_time'
                            id: min_inspiratory_time
                            text: "2.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_inspiratory_time
                            text: 'Max Inspiratory Time [Seconds]'
                        SmallVButton:
                            name: 'max_inspiratory_time'
                            id: max_inspiratory_time
                            text: "2.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_inspiratory_pressure
                            text: 'Max Inspiratory Pressure [cmH20]'
                        SmallVButton:
                            name: 'max_inspiratory_pressure'
                            id: max_inspiratory_pressure
                            text: "15.0"
                            on_press: self.callback()

                # Column 3
                SettingsColumnLogic:
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: tidal_volume
                            text: 'Tidal Volume [mL]'
                        SmallVButton:
                            name:'tidal_volume'
                            id: tidal_volume
                            text: "800.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_inspiratory_tidal_volume
                            text: 'Max Inspiratory Tidal Volume [mL]'
                        SmallVButton:
                            name:'max_inspiratory_tidal_volume'
                            id: max_inspiratory_tidal_volume
                            text: "800.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: min_inspiratory_tidal_volume
                            text: 'Min Inspiratory Tidal Volume [mL]'
                        SmallVButton:
                            id: min_inspiratory_tidal_volume
                            name: 'Min Inspiratory Tidal Volume [mL]'
                            text: "300.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_expiratory_tidal_volume
                            text:'Max Expiratory Tidal Volume [mL]'
                        SmallVButton:
                            name: 'max_expiratory_tidal_volume'
                            id: max_expiratory_tidal_volume
                            text: "800.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: min_expiratory_tidal_volume
                            text: 'Max Inspiratory Time [Seconds]'
                        SmallVButton:
                            name: 'Min Expriatory Tidal Volume [mL]'
                            id: min_expiratory_tidal_volume
                            text: "300.0"
                            on_press: self.callback()
                # Row 4
                SettingsColumnLogic:
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: min_leak
                            text: 'Min Leak [mL/min]'
                        SmallVButton:
                            id: min_leak
                            name: 'min_leak'
                            text: "0.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_leak
                            text: 'Max Leak [mL/min]'
                        SmallVButton:
                            id: max_leak
                            name: 'max_leak'
                            text: "50.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: apnoea_time
                            text: 'Apnoea Time [Seconds]'
                        SmallVButton:
                            name: 'apnoea_time'
                            id: apnoea_time
                            text: "10.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_pressure
                            text: 'Max Pressure [cmH2O]'
                        SmallVButton:
                            name: 'max_pressure'
                            id: max_pressure
                            text: "40.0"
                            on_press: self.callback()
                    SettingsItemLogic:
                        SettingsItemLabel:
                            id: max_pressure
                            text: 'Max Pressure [cmH2O]'
                        SmallVButton:
                            name: 'max_pressure'
                            id: max_pressure
                            text: "40.0"
                            on_press: self.callback()
                        



######### UI Element Snippets: #########

## RESET BUTTON PANEL
#Logic:
#    size_hint_y: None
#    size_hint: 1, 0.05
#    Button:
#        text: 'Reset Configuration'
#        on_press: input_1.value = 0; input_2.value = 0; input_3.value = 1; input_4.value = 1; input_5.value = 0; input_6.value = 0


## A template slider element
#Logic:
#    orientation: 'vertical'
#    Slider:
#        id: parameter_2
#        min: -360.
#        max: 360.
#        value: 360
#    Label:
#        text: 'Inspiratory Pressure (cmH2O) = {}'.format(parameter_2.value)


## Template buttons
#Logic:
#    orientation: 'vertical'
#    Logic:
#        id: parameter_1
#        min: 10
#        max: 0
#        Button:
#            text: 'Reset Configuration'
#            on_press: parameter_1 = parameter_1 - 1
#        Button:
#            text: 'Reset Configuration'
#            on_press: parameter_1 = parameter_1 + 1
#        Label:
#            text: 'Breath Frequency (b/min) = {}'.format(parameter_1)